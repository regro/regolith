var ut=ut||{};ut.KEY_BACKSPACE=8;ut.KEY_TAB=9;ut.KEY_ENTER=13;ut.KEY_SHIFT=16;ut.KEY_CTRL=17;ut.KEY_ALT=18;ut.KEY_ESCAPE=27;ut.KEY_SPACE=32;ut.KEY_LEFT=37;ut.KEY_UP=38;ut.KEY_RIGHT=39;ut.KEY_DOWN=40;ut.KEY_0=48;ut.KEY_1=49;ut.KEY_2=50;ut.KEY_3=51;ut.KEY_4=52;ut.KEY_5=53;ut.KEY_6=54;ut.KEY_7=55;ut.KEY_8=56;ut.KEY_9=57;ut.KEY_A=65;ut.KEY_B=66;ut.KEY_C=67;ut.KEY_D=68;ut.KEY_E=69;ut.KEY_F=70;ut.KEY_G=71;ut.KEY_H=72;ut.KEY_I=73;ut.KEY_J=74;ut.KEY_K=75;ut.KEY_L=76;ut.KEY_M=77;ut.KEY_N=78;ut.KEY_O=79;
ut.KEY_P=80;ut.KEY_Q=81;ut.KEY_R=82;ut.KEY_S=83;ut.KEY_T=84;ut.KEY_U=85;ut.KEY_V=86;ut.KEY_W=87;ut.KEY_X=88;ut.KEY_Y=89;ut.KEY_Z=90;ut.KEY_NUMPAD0=96;ut.KEY_NUMPAD1=97;ut.KEY_NUMPAD2=98;ut.KEY_NUMPAD3=99;ut.KEY_NUMPAD4=100;ut.KEY_NUMPAD5=101;ut.KEY_NUMPAD6=102;ut.KEY_NUMPAD7=103;ut.KEY_NUMPAD8=104;ut.KEY_NUMPAD9=105;ut.KEY_F1=112;ut.KEY_F2=113;ut.KEY_F3=114;ut.KEY_F4=115;ut.KEY_F5=116;ut.KEY_F6=117;ut.KEY_F7=118;ut.KEY_F8=119;ut.KEY_F9=120;ut.KEY_F10=121;ut.KEY_F11=122;ut.KEY_F12=123;
ut.KEY_COMMA=188;ut.KEY_DASH=189;ut.KEY_PERIOD=190;ut.pressedKeys={};ut.keyRepeatDelay=150;ut.isKeyPressed=function(a){return ut.pressedKeys[a]?!0:!1};ut.setKeyRepeatInterval=function(a){ut.keyRepeatDelay=a};
ut.initInput=function(a,b){ut.onkeydown=a;ut.onkeyup=b;document.onkeydown=function(a){a=a.keyCode;if(null!==ut.pressedKeys[a]&&void 0!==ut.pressedKeys[a])return!1;ut.pressedKeys[a]=!0;ut.onkeydown&&(ut.onkeydown(a),ut.pressedKeys[a]=setInterval("ut.onkeydown("+a+")",ut.keyRepeatDelay));return ut.pressedKeys[ut.KEY_CTRL]||ut.pressedKeys[ut.KEY_ALT]?!0:!1};document.onkeyup=function(a){a=a.keyCode;ut.onkeydown&&(null!==ut.pressedKeys[a]&&void 0!==ut.pressedKeys[a])&&clearInterval(ut.pressedKeys[a]);
ut.pressedKeys[a]=null;if(ut.onkeyup)ut.onkeyup(a);return!1};window.onblur=function(){for(var a in ut.pressedKeys)ut.onkeydown&&null!==ut.pressedKeys[a]&&clearInterval(ut.pressedKeys[a]);ut.pressedKeys={}}};window.console||(window.console={},window.console.log=function(){});ut=ut||{};ut.VERSION="2.1";ut.NULLCHAR=" ";ut.CSSCLASS="unicodetiles";ut.NULLTILE={};ut.Tile=function(a,b,c,d,h,k,e){this.ch=a||ut.NULLCHAR;this.r=b;this.g=c;this.b=d;this.br=h;this.bg=k;this.bb=e};ut.Tile.prototype.getChar=function(){return this.ch};ut.Tile.prototype.setChar=function(a){this.ch=a};ut.Tile.prototype.setColor=function(a,b,c){this.r=a;this.g=b;this.b=c};ut.Tile.prototype.setGrey=function(a){this.b=this.g=this.r=a};
ut.Tile.prototype.setBackground=function(a,b,c){this.br=a;this.bg=b;this.bb=c};ut.Tile.prototype.resetColor=function(){this.r=this.g=this.b=void 0};ut.Tile.prototype.resetBackground=function(){this.br=this.bg=this.bb=void 0};ut.Tile.prototype.getColorHex=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""};
ut.Tile.prototype.getBackgroundHex=function(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""};ut.Tile.prototype.getColorRGB=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"rgb("+this.r+","+this.g+","+this.b+")":""};ut.Tile.prototype.getBackgroundRGB=function(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"rgb("+this.br+","+this.bg+","+this.bb+")":""};
ut.Tile.prototype.getColorJSON=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}};ut.Tile.prototype.getBackgroundJSON=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}};ut.Tile.prototype.copy=function(a){this.ch=a.ch;this.r=a.r;this.g=a.g;this.b=a.b;this.br=a.br;this.bg=a.bg;this.bb=a.bb};ut.Tile.prototype.clone=function(){return new ut.Tile(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)};
ut.NULLTILE=new ut.Tile;
ut.Viewport=function(a,b,c,d,h){this.elem=a;this.elem.innerHTML="";this.w=b;this.h=c;this.renderer=null;this.squarify=h;this.cx=Math.floor(b/2);this.cy=Math.floor(c/2);-1===a.className.indexOf(ut.CSSCLASS)&&(a.className=0===a.className.length?ut.CSSCLASS:a.className+(" "+ut.CSSCLASS));this.buffer=Array(c);for(a=0;a<c;++a){this.buffer[a]=Array(b);for(h=0;h<b;++h)this.buffer[a][h]=new ut.Tile}this.updateStyle=function(a){var d=window.getComputedStyle(this.elem,null);this.defaultColor=d.color;this.defaultBackground=
d.backgroundColor;!1!==a&&this.renderer.updateStyle(d)};this.setRenderer=function(a){this.elem.innerHTML="";if("auto"===a||"webgl"===a)try{this.renderer=new ut.WebGLRenderer(this)}catch(d){console.log(d),a="canvas",this.elem.innerHTML=""}if("canvas"===a)try{this.renderer=new ut.CanvasRenderer(this)}catch(b){console.log(b),a="dom",this.elem.innerHTML=""}"dom"===a&&(this.renderer=new ut.DOMRenderer(this));this.updateStyle(!1)};this.setRenderer(d||"auto")};
ut.Viewport.prototype.getRendererString=function(){return this.renderer instanceof ut.WebGLRenderer?"webgl":this.renderer instanceof ut.CanvasRenderer?"canvas":this.renderer instanceof ut.DOMRenderer?"dom":""};ut.Viewport.prototype.put=function(a,b,c){0>b||(0>c||b>=this.w||c>=this.h)||(this.buffer[c][b]=a)};ut.Viewport.prototype.unsafePut=function(a,b,c){this.buffer[c][b]=a};
ut.Viewport.prototype.putString=function(a,b,c,d,h,k,e,j,f){var g=a.length,m;if(!(0>b||0>c))for(var l=0;l<g;++l){b>=this.w&&(b=0,++c);if(c>=this.h)break;m=new ut.Tile(a[l],d,h,k,e,j,f);this.unsafePut(m,b,c);++b}};ut.Viewport.prototype.get=function(a,b){return 0>a||0>b||a>=this.w||b>=this.h?ut.NULLTILE:this.buffer[b][a]};ut.Viewport.prototype.clear=function(){for(var a=0;a<this.h;++a)for(var b=0;b<this.w;++b)this.buffer[a][b]=ut.NULLTILE;this.renderer.clear()};ut.Viewport.prototype.render=function(){this.renderer.render()};
ut.Engine=function(a,b,c,d){this.viewport=a;this.tileFunc=b;this.w=c;this.h=d;this.refreshCache=!0;this.cacheEnabled=!1;this.transitionTimer=null;this.transitionDuration=0;this.transition=null;this.cachey=this.cachex=0;this.tileCache=Array(a.h);this.tileCache2=Array(a.h);for(b=0;b<a.h;++b)this.tileCache[b]=Array(a.w),this.tileCache2[b]=Array(a.w)};
ut.Engine.prototype.setTileFunc=function(a,b,c){b&&(this.transition=void 0,"string"===typeof b&&("boxin"===b?this.transition=function(a,b,c,e,j,f,g){c*=0.5;e*=0.5;b-=e;return Math.abs(a-c)<c*g&&Math.abs(b)<e*g?j:f}:"boxout"===b?this.transition=function(a,b,c,e,j,f,g){c*=0.5;e*=0.5;b-=e;g=1-g;return Math.abs(a-c)<c*g&&Math.abs(b)<e*g?f:j}:"circlein"===b?this.transition=function(a,b,c,e,j,f,g){c*=0.5;e*=0.5;a-=c;b-=e;return a*a+b*b<(c*c+e*e)*g?j:f}:"circleout"===b?this.transition=function(a,b,c,e,j,
f,g){c*=0.5;e*=0.5;a-=c;b-=e;return a*a+b*b>(c*c+e*e)*(1-g)?j:f}:"random"===b&&(this.transition=function(a,b,c,e,j,f,g){return Math.random()>g?f:j})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=c||500));this.tileFunc=a};ut.Engine.prototype.setMaskFunc=function(a){this.maskFunc=a};ut.Engine.prototype.setShaderFunc=function(a){this.shaderFunc=a};ut.Engine.prototype.setWorldSize=function(a,b){this.w=a;this.h=b};
ut.Engine.prototype.setCacheEnabled=function(a){this.cacheEnabled=a;this.refreshCache=!0};
ut.Engine.prototype.update=function(a,b){var c=(a||0)-this.viewport.cx,d=(b||0)-this.viewport.cy,h=(new Date).getTime(),k;this.transition&&(k=(h-this.transitionTimer)/this.transitionDuration);1<=k&&(this.transition=void 0);for(var e,j=0;j<this.viewport.h;++j)for(var f=0;f<this.viewport.w;++f){var g=f+c,m=j+d;if(this.w&&(0>g||g>=this.w))e=ut.NULLTILE;else if(this.h&&(0>m||m>=this.w))e=ut.NULLTILE;else if(this.maskFunc&&!this.maskFunc(g,m))e=ut.NULLTILE;else if(this.transition&&!this.refreshCache)e=
this.transition(f,j,this.viewport.w,this.viewport.h,this.tileFunc(g,m),this.tileCache[j][f],k);else if(this.cacheEnabled&&!this.refreshCache){e=g-this.cachex;var l=m-this.cachey;0<=e&&e<this.viewport.w&&0<=l&&l<this.viewport.h?(e=this.tileCache[l][e],e===ut.NULLTILE&&(e=this.tileFunc(g,m))):e=this.tileFunc(g,m)}else e=this.tileFunc(g,m);this.tileCache2[j][f]=e;this.shaderFunc&&e!==ut.NULLTILE&&(e=this.shaderFunc(e,g,m,h));this.viewport.unsafePut(e,f,j)}this.cachex=c;this.cachey=d;c=this.tileCache;
this.tileCache=this.tileCache2;this.tileCache2=c;this.refreshCache=!1};ut.CanvasRenderer=function(a){this.view=a;this.canvas=document.createElement("canvas");if(!this.canvas.getContext)throw"Canvas not supported";this.ctx2=this.canvas.getContext("2d");if(!this.ctx2||!this.ctx2.fillText)throw"Canvas not supported";a.elem.appendChild(this.canvas);this.offscreen=document.createElement("canvas");this.ctx=this.offscreen.getContext("2d");this.updateStyle();this.canvas.width=(a.squarify?this.th:this.tw)*a.w;this.canvas.height=this.th*a.h;this.offscreen.width=this.canvas.width;
this.offscreen.height=this.canvas.height;this.updateStyle()};ut.CanvasRenderer.prototype.updateStyle=function(a){a=a||window.getComputedStyle(this.view.elem,null);this.ctx.font=a.fontSize+"/"+a.lineHeight+" "+a.fontFamily;this.ctx.textBaseline="middle";this.tw=this.ctx.measureText("M").width;this.th=parseInt(a.fontSize,10);this.gap=this.view.squarify?this.th-this.tw:0;this.view.squarify&&(this.tw=this.th)};ut.CanvasRenderer.prototype.clear=function(){};
ut.CanvasRenderer.prototype.render=function(){var a,b,c,d,h,k=this.view,e=this.view.buffer,j=k.w,f=k.h,g=0.5*this.th,m=0.5*this.gap;this.ctx.fillStyle=k.defaultBackground;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);h=g;for(var l=0;l<f;++l){for(var p=d=0;p<j;++p)a=e[l][p],b=a.ch,c=a.getColorRGB(),a=a.getBackgroundRGB(),a.length&&a!==k.defaultBackground&&(this.ctx.fillStyle=a,this.ctx.fillRect(d,h-g,this.tw,this.th)),b.length&&(c.length||(c=k.defaultColor),this.ctx.fillStyle=c,this.ctx.fillText(b,
d+m,h)),d+=this.tw;h+=this.th}this.ctx2.drawImage(this.offscreen,0,0)};ut.DOMRenderer=function(a){this.view=a;this.spans=Array(a.h);this.colors=Array(a.h);for(var b=0;b<a.h;++b){this.spans[b]=Array(a.w);this.colors[b]=Array(a.w);for(var c=0;c<a.w;++c)this.spans[b][c]=document.createElement("div"),a.elem.appendChild(this.spans[b][c]);this.spans[b].push(document.createElement("br"));a.elem.appendChild(this.spans[b][a.w])}ut.viewportStyleUpdaterHack=this;setTimeout(function(){ut.viewportStyleUpdaterHack.updateStyle()},0)};
ut.DOMRenderer.prototype.updateStyle=function(a){a=window.getComputedStyle(this.spans[0][0],null);this.tw=parseInt(a.width,10);if(!(0===this.tw||isNaN(this.tw))){this.th=parseInt(a.height,10);this.view.squarify&&(this.tw=this.th);a=this.view.w;for(var b=this.view.h,c=0;c<b;++c)for(var d=0;d<a;++d)this.spans[c][d].style.width=this.tw+"px"}};ut.DOMRenderer.prototype.clear=function(){for(var a=0;a<this.view.h;++a)for(var b=0;b<this.view.w;++b)this.colors[a][b]=""};
ut.DOMRenderer.prototype.render=function(){for(var a=this.view.w,b=this.view.h,c=this.view.buffer,d=this.view.defaultColor,h=this.view.defaultBackground,k=0;k<b;++k)for(var e=0;e<a;++e){var j=c[k][e],f=this.spans[k][e],g=void 0===j.r?d:j.getColorRGB(),m=void 0===j.br?h:j.getBackgroundRGB(),l=g+m;l!==this.colors[k][e]&&(this.colors[k][e]=l,f.style.color=g,f.style.backgroundColor=m);j=j.getChar();j!==f.innerHTML&&(f.innerHTML=j)}};ut.viewportStyleUpdaterHack=null;ut.WebGLRenderer=function(a){function b(a,b,d,c,h,l){h=d+h;l=c+l;a[b]=d;a[++b]=c;a[++b]=h;a[++b]=c;a[++b]=d;a[++b]=l;a[++b]=d;a[++b]=l;a[++b]=h;a[++b]=c;a[++b]=h;a[++b]=l}function c(a,b){var c=d.createShader(a);d.shaderSource(c,b);d.compileShader(c);if(!d.getShaderParameter(c,d.COMPILE_STATUS)){var g="Error compiling shader: "+d.getShaderInfoLog(c);d.deleteShader(c);throw g;}return c}this.view=a;this.canvas=document.createElement("canvas");if(!this.canvas.getContext)throw"Canvas not supported";this.gl=
this.canvas.getContext("experimental-webgl");if(!this.gl)throw"WebGL not supported";var d=this.gl;a.elem.appendChild(this.canvas);this.charMap={};this.charArray=[];this.defaultColors={r:1,g:1,b:1,br:0,bg:0,bb:0};this.attribs={position:{buffer:null,data:null,itemSize:2,location:null,hint:d.STATIC_DRAW},texCoord:{buffer:null,data:null,itemSize:2,location:null,hint:d.STATIC_DRAW},color:{buffer:null,data:null,itemSize:3,location:null,hint:d.DYNAMIC_DRAW},bgColor:{buffer:null,data:null,itemSize:3,location:null,
hint:d.DYNAMIC_DRAW},charIndex:{buffer:null,data:null,itemSize:1,location:null,hint:d.DYNAMIC_DRAW}};this.initBuffers=function(){var a,c,f=this.attribs,g=this.view.w,h=this.view.h;for(a in this.attribs)c=f[a],c.data=new Float32Array(6*c.itemSize*g*h);for(c=0;c<h;++c)for(var l=0;l<g;++l){var k=6*f.position.itemSize*(c*g+l);b(f.position.data,k,l*this.tw,c*this.th,this.tw,this.th);b(f.texCoord.data,k,0,0,1,1)}for(a in this.attribs)c=f[a],c.buffer&&d.deleteBuffer(c.buffer),c.buffer=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,
c.buffer),d.bufferData(d.ARRAY_BUFFER,c.data,c.hint),d.enableVertexAttribArray(c.location),d.vertexAttribPointer(c.location,c.itemSize,d.FLOAT,!1,0,0)};this.offscreen||(this.offscreen=document.createElement("canvas"));this.offscreen.style.position="absolute";this.offscreen.style.top="0px";this.offscreen.style.left="0px";this.ctx=this.offscreen.getContext("2d");this.updateStyle();this.canvas.width=(a.squarify?this.th:this.tw)*a.w;this.canvas.height=this.th*a.h;this.offscreen.width=0;this.offscreen.height=
0;this.updateStyle();d.viewport(0,0,this.canvas.width,this.canvas.height);var h=c(d.VERTEX_SHADER,ut.WebGLRenderer.VERTEX_SHADER),k=c(d.FRAGMENT_SHADER,ut.WebGLRenderer.FRAGMENT_SHADER);a=d.createProgram();d.attachShader(a,h);d.attachShader(a,k);d.linkProgram(a);d.deleteShader(h);d.deleteShader(k);if(!d.getProgramParameter(a,d.LINK_STATUS))throw h="Error linking program: "+d.getProgramInfoLog(a),d.deleteProgram(a),h;d.useProgram(a);this.attribs.position.location=d.getAttribLocation(a,"position");
this.attribs.texCoord.location=d.getAttribLocation(a,"texCoord");this.attribs.color.location=d.getAttribLocation(a,"color");this.attribs.bgColor.location=d.getAttribLocation(a,"bgColor");this.attribs.charIndex.location=d.getAttribLocation(a,"charIndex");this.initBuffers();h=d.getUniformLocation(a,"uResolution");d.uniform2f(h,this.canvas.width,this.canvas.height);this.tileCountsLocation=d.getUniformLocation(a,"uTileCounts");d.uniform2f(this.tileCountsLocation,this.view.w,this.view.h);this.paddingLocation=
d.getUniformLocation(a,"uPadding");d.uniform2f(this.paddingLocation,0,0);a=d.createTexture();d.bindTexture(d.TEXTURE_2D,a);this.cacheChars(" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~");d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.activeTexture(d.TEXTURE0)};
ut.WebGLRenderer.prototype.buildTexture=function(){var a=this.gl,b=this.offscreen.width/(this.tw+this.pad),c=this.offscreen.height/(this.th+this.pad),d=this.charArray.length;d>Math.floor(b)*Math.floor(c)&&(b=Math.ceil(Math.sqrt(d)),c=b+2,this.offscreen.width=b*(this.tw+this.pad),this.offscreen.height=c*(this.th+this.pad),this.updateStyle(),a.uniform2f(this.tileCountsLocation,b,c));a.uniform2f(this.paddingLocation,this.pad/this.offscreen.width,this.pad/this.offscreen.height);var d=0,h,k=0.5*this.gap;
this.ctx.fillStyle="#000000";this.ctx.fillRect(0,0,this.offscreen.width,this.offscreen.height);this.ctx.fillStyle="#ffffff";for(var e=this.tw+this.pad,j=this.th+this.pad,f=0.5*j,g=0;g<c;++g){for(var m=0.5*this.pad,l=0;l<b;++l,++d){h=this.charArray[d];if(void 0===h)break;this.ctx.fillText(h,m+k,f);m+=e}if(!h)break;f+=j}a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.offscreen)};
ut.WebGLRenderer.prototype.cacheChars=function(a,b){if(this.gl){for(var c=!1,d=0;d<a.length;++d)this.charMap[a[d]]||(c=!0,this.charArray.push(a[d]),this.charMap[a[d]]=this.charArray.length-1);c&&!1!==b&&this.buildTexture()}};
ut.WebGLRenderer.prototype.updateStyle=function(a){a=a||window.getComputedStyle(this.view.elem,null);this.ctx.font=a.fontSize+"/"+a.lineHeight+" "+a.fontFamily;this.ctx.textBaseline="middle";this.ctx.fillStyle="#ffffff";this.tw=this.ctx.measureText("M").width;this.th=parseInt(a.fontSize,10);this.gap=this.view.squarify?this.th-this.tw:0;this.view.squarify&&(this.tw=this.th);this.pad=2*Math.ceil(0.2*this.th);var b=a.color.match(/\d+/g);a=a.backgroundColor.match(/\d+/g);this.defaultColors.r=parseInt(b[0],
10)/255;this.defaultColors.g=parseInt(b[1],10)/255;this.defaultColors.b=parseInt(b[2],10)/255;this.defaultColors.br=parseInt(a[0],10)/255;this.defaultColors.bg=parseInt(a[1],10)/255;this.defaultColors.bb=parseInt(a[2],10)/255};ut.WebGLRenderer.prototype.clear=function(){};
ut.WebGLRenderer.prototype.render=function(){var a=this.gl;a.clear(a.COLOR_BUFFER_BIT);for(var b=this.attribs,c=this.view.w,d=this.view.h,h=this.view.buffer,k=!1,e=0;e<d;++e)for(var j=0;j<c;++j){var f=h[e][j],g=this.charMap[f.ch];void 0===g&&(this.cacheChars(f.ch,!1),k=!0,g=this.charMap[f.ch]);for(var m=6*b.color.itemSize*(e*c+j),l=6*b.charIndex.itemSize*(e*c+j),p=void 0===f.r?this.defaultColors.r:f.r/255,r=void 0===f.g?this.defaultColors.g:f.g/255,s=void 0===f.b?this.defaultColors.b:f.b/255,t=void 0===
f.br?this.defaultColors.br:f.br/255,u=void 0===f.bg?this.defaultColors.bg:f.bg/255,f=void 0===f.bb?this.defaultColors.bb:f.bb/255,q=0;6>q;++q){var n=m+q*b.color.itemSize;b.color.data[n+0]=p;b.color.data[n+1]=r;b.color.data[n+2]=s;b.bgColor.data[n+0]=t;b.bgColor.data[n+1]=u;b.bgColor.data[n+2]=f;b.charIndex.data[l+q]=g}}k&&this.buildTexture();a.bindBuffer(a.ARRAY_BUFFER,b.color.buffer);a.bufferData(a.ARRAY_BUFFER,b.color.data,b.color.hint);a.bindBuffer(a.ARRAY_BUFFER,b.bgColor.buffer);a.bufferData(a.ARRAY_BUFFER,
b.bgColor.data,b.bgColor.hint);a.bindBuffer(a.ARRAY_BUFFER,b.charIndex.buffer);a.bufferData(a.ARRAY_BUFFER,b.charIndex.data,b.charIndex.hint);b=this.attribs.position;a.drawArrays(a.TRIANGLES,0,b.data.length/b.itemSize)};ut.WebGLRenderer.VERTEX_SHADER="attribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\nvoid main() {\nvec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\nvTexCoord = (texCoord + tileCoords) / uTileCounts;\nvTexCoord += (0.5 - texCoord) * uPadding;\nvColor = color;\nvBgColor = bgColor;\nvec2 pos = position / uResolution * 2.0 - 1.0;\ngl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}";
ut.WebGLRenderer.FRAGMENT_SHADER="precision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\nvoid main() {\nvec4 color = texture2D(uFont, vTexCoord);\ncolor.rgb = mix(vBgColor, vColor, color.rgb);\ngl_FragColor = color;\n}";
